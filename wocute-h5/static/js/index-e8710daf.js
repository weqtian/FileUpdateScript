import{c as e,a as n,m as t,t as a,d as s,p as o,F as l,w as i,b1 as r,S as m,T as c,L as d,g as p,N as u,O as h,M as g,b2 as v,j as f,ag as C,G as T,e as y,o as A,k as b,ak as I,am as k,u as x,a6 as U,aW as R,b3 as _,_ as w,ai as O,aj as M,a8 as N,aZ as L,v as H,aT as Q,aY as E,aN as D,ap as P,b4 as S,b5 as $,al as B,q as F,aA as q,b6 as j,aq as J}from "./index-ee55951f.js";import{d as Y,l as W,M as z,H as V}from "./LangPlug-4fa84100.js";import{I as K}from "./index-456f307c.js";import{H as X,D as G,O as Z,a as ee}from "./index-3ad53b22.js";import{t as ne}from "./Time-d7827038.js";import{u as te}from "./use-tab-status-53cd34df.js";const[ae,se,oe]=e("list");const le=f(s({name:ae,props:{error:Boolean,offset:n(300),loading:Boolean,disabled:Boolean,finished:Boolean,errorText:String,direction:t("down"),loadingText:String,finishedText:String,immediateCheck:a},emits:["load","update:error","update:loading"],setup(e, {emit:n,slots:t}){const a=o(e.loading),s=o(),f=o(),C=te(),T=l(s),y=()=>{u((()=>{if(a.value||e.finished||e.disabled||e.error||!1===(null==C?void 0:C.value))return;const{direction:t}=e,o=+e.offset,l=h(T);if(!l.height||g(s))return;let i=!1;const r=h(f);i="up"===t?l.top-r.top<=o:r.bottom-l.bottom<=o,i&&(a.value=!0,n("update:loading",!0),n("load"))}))},A=()=>{if(e.finished){const n=t.finished?t.finished():e.finishedText;if(n)return p("div",{class:se("finished-text")},[n])}},b=()=>{n("update:error",!1),y()},I=()=>{if(e.error){const n=t.error?t.error():e.errorText;if(n)return p("div",{role:"button",class:se("error-text"),tabindex:0,onClick:b},[n])}},k=()=>{if(a.value&&!e.finished&&!e.disabled)return p("div",{class:se("loading")},[t.loading?t.loading():p(v,{class:se("loading-icon")},{default:()=>[e.loadingText||oe("loading")]})])};return i((()=>[e.loading,e.finished,e.error]),y),C&&i(C,(e=>{e&&y()})),r((()=>{a.value=e.loading})),m((()=>{e.immediateCheck&&y()})),c({check:y}),d("scroll",y,{target:T,passive:!0}),()=>{var n;const o=null==(n=t.default)?void 0:n.call(t),l=p("div",{ref:f,class:se("placeholder")},null);return p("div",{ref:s,role:"feed",class:se(),"aria-busy":a.value},["down"===e.direction?o:l,k(),A(),I(),"up"===e.direction?o:l])}}})),ie= e=>Y.post({url:"/services/community/api/tweetsComment/comment",data:e},{showErrorMessage:!1}),re={zh:{addAComment:"添加评论..."},en:{addAComment:"Add a comment..."},fr:{addAComment:"Ajouter un commentaire..."},ar:{addAComment:"اضفي تعليق..."}},me=w(s({__name:"index",props:{placeholder:{type:String,required:!1,default:""}},emits:["onContent"],setup(e, {emit:n}){const t=e,a=W(re),s=C(),o=T({NOT_SENT:y((()=>"/static/svg/not-sent-474db72f.svg"))}),l={openAppInput(e){const a=e||t.placeholder;s.setClientInfo().then((e=>{e&&e.isRealName?R({placeholder:a}).then((e=>{n("onContent",e)})):_({sceneType:5})}))}};return(e, n)=>{const i=K;return A(),b("div",{class:U(["comments-input",{"comments-input-ar":x(s).getIsRtl}])},[I("div",{class:"input-box placeholder",onClick:n[0]||(n[0]= e=>l.openAppInput(x(a)("addAComment")))},k(t.placeholder||x(a)("addAComment")),1),p(i,{class:"sent-icon",src:o.NOT_SENT},null,8,["src"])],2)}}}),[["__scopeId","data-v-1467d042"],["__file","/Users/xiaobo/Desktop/wocute/h5-client-cache/source/src/components/Comments/Input/index.vue"]]),ce={zh:{beTheFirstToReply:"Be the first to reply",replyToJs:"回复 {0}",replyYourOwnComment:"不能回复自己的评论",replyTo:'\n            <span class="commented-label">回复</span>\n            <span class="commented-name">{0}:</span>\n        ',comments:'\n            <span class="tips">评论</span>\n            <span class="number">{0}</span>\n        '},en:{beTheFirstToReply:"Be the first to reply",replyToJs:"Reply to {0}",replyYourOwnComment:"Can't reply your own comment",replyTo:'\n            <span class="commented-label">Reply to</span>\n            <span class="commented-name">{0}:</span>\n        ',comments:'\n            <span class="tips">Comments</span>\n            <span class="number">{0}</span>\n        '},fr:{beTheFirstToReply:"Soyez le premier à répondre",replyToJs:"Répondre à {0}",replyYourOwnComment:"Impossible de répondre à votre propre commentaire",replyTo:'\n             <span class="commented-label">Répondre à</span>\n             <span class="commented-name">{0}:</span>\n        ',comments:'\n            <span class="tips">Commentaires</span>\n            <span class="number">{0}</span>\n        '},ar:{beTheFirstToReply:"كوني صاحبة التعليق الأول",replyToJs:"{0} الرد على",replyYourOwnComment:"لا يمكنكِ الرد على تعليقاتك",replyTo:'\n            <span class="commented-name">{0}</span>\n            <span class="commented-label">الرد على</span>\n        ',comments:'\n            <span class="number">{0}</span>\n            <span class="tips">تعليق</span>\n        '}},de={class:"comments-number"},pe=["innerHTML"],ue={class:"comments-content"},he={class:"content"},ge={class:"name-thumbs-up"},ve=["onClick"],fe={class:"name"},Ce={class:"time"},Te=["onClick"],ye={key:0,class:"number"},Ae=["onClick"],be=["innerHTML"],Ie={key:1,class:"empty-box"},ke={class:"tips"},xe=w(s({__name:"index",props:{total:{type:Number,required:!0,default:0},list:{type:Array,required:!0,default:()=>[]}},emits:["onPushComment","onThumbsUp"],setup(e, {emit:n}){const t=e,a=W(ce),s=C();y((()=>s.getClientInfo.isRealName));const o=y((()=>s.getInsideApp)),l=T({COMMENT_EMPTY:y((()=>"/static/png/comment-empty-b41db195.png")),THUMBS_UP:y((()=> e=>e?"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAABACAMAAACdt4HsAAAAM1BMVEUAAAD6Qm/6Q2/6Q3D6QHD7Q2/7Qm/5QnD/QHD7QnD7QnD5QHD7Q2/8Q3D7Q2/7Q2/6Q29TBvmiAAAAEHRSTlMA3++AIL+gcBBgQDCQUM+vfNX0lAAAAQpJREFUWMPt1ctuxCAMBVBj3o9k/P9f20WVWiF0Zri0m1HOEsnWtYWAbh+pxvbwvsXaH4fgHy1XeipZloPJTo+NHgf3slxbfJ9HlpOWaMgZ6e2OqHrpmWGIwjLAZnia6aLKlHLJzzKF+ymMTPJ0kmVaxAIoTtcAeAQvCtmCE4jOsAlko4MVBS0hCKStNgh/16CtjhBXl1gEUuiQWAC8epUDqYJPgEfYzy8qGgCPENYeVf0a0MuU6cJjA6hkJgZINFAZWAD2OVT6hQUWCHSw9IQF65UF65UF65V9XY93iKSADpzpTRvLgKn0NmfG93elg080JYX+F5pmRXEkQDE/8SthtrAzm1bodvtvX/Opd0WxDiq3AAAAAElFTkSuQmCC":X)),AVATAR:y((()=> e=>`background-image: url(${e||G})`))}),i={thumbsUp(e){n("onThumbsUp",e)},onCommentItem(e){function t(){if(s.getClientInfo.isRealName){const{tweetsId:t,id:o,commentRealityUserInfo:l,commentLogin:i}=e,r=null==l?void 0:l.login,m=null==l?void 0:l.nickname,c=a("replyToJs",m);if(r===s.getClientInfo.login)return void Q(a("replyYourOwnComment"));R({placeholder:c}).then((e=>{ie({tweetsId:t,parentCommentId:o,replyCommentId:o,replyLogin:i,text:e}).then((e=>{o?E().then((e=>{D("insights文章","article_comment_click",`articleId=${t}&action=2&commentId=${o}&sd=${e.source}`)})):E().then((e=>{D("insights文章","article_comment_click",`articleId=${t}&action=1&sd=${e.source}`)})),n("onPushComment",e.data)}))}))}else _({sceneType:6})}o.value&&(s.getClientInfo.isRealName?t():s.setClientInfo({setTitle:!1}).then((()=>{t()})))}};return(e, n)=>{const o=K;return A(),b("div",{class:U(["comments-container",{"comments-container-ar":x(s).getIsRtl}])},[t.list.length?(A(),b(O,{key:0},[I("div",de,[I("div",{innerHTML:x(a)("comments",t.total)},null,8,pe)]),I("div",ue,[(A(!0),b(O,null,M(t.list,((e, n)=>(A(),b("div",{key:n,class:"item"},[I("div",{style:N(l.AVATAR(e.commentRealityUserInfo&&e.commentRealityUserInfo.headImgFileUrl)),class:"bg-img portrait"},null,4),I("div",he,[I("div",ge,[I("div",{class:"name-time",onClick: n=>i.onCommentItem(e)},[I("div",fe,k(e.commentRealityUserInfo&&e.commentRealityUserInfo.nickname),1),I("div",Ce,k(x(ne)(e.commentTime)),1)],8,ve),I("div",{class:U(["thumbs-up",{"no-thumbs-up":!e.liked}]),onClick:L((e=>i.thumbsUp(n)),["stop"])},[e.like?(A(),b("div",ye,k(e.like),1)):H("v-if",!0),p(o,{class:"icon",src:l.THUMBS_UP(e.liked)},null,8,["src"])],10,Te)]),I("div",{class:"comments",onClick: n=>i.onCommentItem(e)},[e.replyRealityUserInfo&&e.replyRealityUserInfo.nickname?(A(),b("span",{key:0,innerHTML:x(a)("replyTo",e.replyRealityUserInfo.nickname)},null,8,be)):H("v-if",!0),I("span",null,k(e.text),1)],8,Ae)])])))),128))])],64)):(A(),b("div",Ie,[p(o,{class:"img",src:l.COMMENT_EMPTY},null,8,["src"]),I("p",ke,k(x(a)("beTheFirstToReply")),1)]))],2)}}}),[["__scopeId","data-v-12d5854e"],["__file","/Users/xiaobo/Desktop/wocute/h5-client-cache/source/src/pages/app/article/content/index/components/Comments/Content/index.vue"]]),Ue={class:"insights-article-content"},Re=["innerHTML"],_e=w(s({__name:"index",setup(e){const n=o(!1),t=C(),a=P();let s=!1;const l=y((()=>t.getInsideApp)),i=T({pageNo:1,pageSize:20,total:0}),r=o(!1),c=o(!1),d=o([]),u=o(),h=o();let g=o(t.getLanguage);const{id:v,lang:f,share:k=!1,commentId:U=""}=a.query;S&&$("1.6.2")&&(g.value=t.getPreferredLangKeys);const R={pxToRem(e){const n=Number(e.replace("px",""));return q(n)},regularReplace(e){const n=/width=[\'\"]?([^\'\"]*)[\'\"]?/i,t=/height=[\'\"]?([^\'\"]*)[\'\"]?/i;return e.replace(/<img.*?(?:>|\/>)/gi,(function(e){var a,s;let o=`<div class="insights-article-content-img-item">${e}</div>`;const l=null==(a=o.match(n))?void 0:a[1],i=null==(s=o.match(t))?void 0:s[1];let r="";l&&(r+=`width: ${R.pxToRem(l)};`),i&&(r+=`height: ${R.pxToRem(i)};`);let m=`style='${r}'`;return o.replace(/width="[^"]+"/gi,m)}))},getContentHandle(){var e;(e={id:v},Y.get({url:"/services/community/api/tweets/classification/getTweetsDetailById",params:e,headers:{Authorization:""}})).then((e=>{const{i18nTitle:n,i18nContent:t,coverImgUrl:a}=e.data||{};if(!n&&!t)return;let s,o;if(f)s=n[f],o=t[f],g.value=f;else{let e=function(){a.length?(g.value=a[0],a.splice(0,1),s=null==n?void 0:n[g.value],o=null==t?void 0:t[g.value],s&&o||e()):(s="",o="")};s=n[g.value],o=null==t?void 0:t[g.value];let a=["ar","en","fr"];s&&o||e()}if(o){h.value=R.regularReplace(o);const e=`${window.location.href}&language=${g.value}&share=true`;j({title:s,url:e,image:a,id:v})}document.title=s}))},getCommentList(e=i.pageNo, n=i.pageSize){var t;r.value=!0,(t={pageNo:e,pageSize:n,commentId:1===e?U:"",tweetsId:v},Y.get({url:"/services/community/api/tweetsComment/getTweetsCommentList",params:t},{appOutsideIgnoreToken:!0})).then((n=>{const{list:t,total:a,hasNextPage:s,nextPage:o}=n.data||{};let l=t;e>1&&(l=t.filter((e=>e.id!==U))),r.value=!1,i.total=a,i.pageNo=o,c.value=!s,d.value=d.value.concat(l)})).catch((()=>{r.value=!1,c.value=!0}))},handlePushCommentData(e){d.value.unshift(e),i.total+=1},handleThumbsUpOrCancel(e){d.value[e].liked=!d.value[e].liked,d.value[e].liked?d.value[e].like+=1:d.value[e].like-=1},handleThumbsUp(e){function a(){var n;if(!s)if(t.getClientInfo.isRealName){const{id:t,liked:a}=d.value[e],o=!a;s=!0,R.handleThumbsUpOrCancel(e),(n={targetId:t,likeType:"TWEETS_COMMENT",like:o},Y.post({url:"/services/community/api/tweetsComment/like",data:n},{showErrorMessage:!1,loading:!1})).then((()=>{o?E().then((e=>{D("insights文章","article_comment_like_click",`articleId=${t}&commentId=${t}&action=1&sd=${e.source}`)})):E().then((e=>{D("insights文章","article_comment_like_click",`articleId=${t}&commentId=${t}&action=2&sd=${e.source}`)}))})).catch((n=>{var t,a;R.handleThumbsUpOrCancel(e),50003===(null==(a=null==(t=null==n?void 0:n.error)?void 0:t.data)?void 0:a.code)&&Q(n.error.data.message)})).finally((()=>{s=!1}))}else _({sceneType:4})}J(k)?n.value=!0:t.getClientInfo.isRealName?a():t.setClientInfo({setTitle:!1}).then((()=>{a()}))},onInputContent(e){ie({text:e,tweetsId:v}).then((e=>{R.handlePushCommentData(e.data)})).catch((e=>{var n,t;50003===(null==(t=null==(n=null==e?void 0:e.error)?void 0:n.data)?void 0:t.code)&&Q(e.error.data.message)}))},onLoad(){R.getCommentList()},openAppLink(){const e=encodeURIComponent(`${V}/to-h5/article/content?id=${v}`);u.value=`?url=${e}`},openApp(){n.value=!0}};return m((()=>{var e;(null==(e=a.query)?void 0:e.id)&&R.getContentHandle(),R.openAppLink()})),(e, a)=>(A(),B(z,null,{default:F((()=>[p(x(Z),{query:u.value},null,8,["query"]),p(x(le),{"loading-text":" ",loading:r.value,finished:c.value,offset:"70",class:"list",onLoad:R.onLoad},{default:F((()=>[I("div",Ue,[I("div",{innerHTML:h.value},null,8,Re)]),H(" 判断 尼日利亚 NG 的国家码 || 首选语言为英语 不显示评论及评论输入框 "),"NG"!==x(t).getClientInfo.countryIso&&"en"!==x(t).getPreferredLangKeys?(A(),b(O,{key:0},[p(x(xe),{list:d.value,total:i.total,onOnPushComment:R.handlePushCommentData,onOnThumbsUp:R.handleThumbsUp},null,8,["list","total","onOnPushComment","onOnThumbsUp"]),l.value?(A(),B(x(me),{key:0,onOnContent:R.onInputContent},null,8,["onOnContent"])):H("v-if",!0)],64)):H("v-if",!0)])),_:1},8,["loading","finished","onLoad"]),p(x(ee),{show:n.value,query:u.value,onOnConfirm:R.openApp,onOnClose:a[0]||(a[0]= e=>n.value=!1)},null,8,["show","query","onOnConfirm"])])),_:1}))}}),[["__scopeId","data-v-40755398"],["__file","/Users/xiaobo/Desktop/wocute/h5-client-cache/source/src/pages/app/article/content/index/index.vue"]]);export{_e as default};
